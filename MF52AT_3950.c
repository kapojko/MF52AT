#include "MF52AT_3950.h"

// normal value
uint32_t mf52at_3950_100k_r[MF52AT_3950_TCOUNT] = {
    8989000, // -55
    8242680, // -54
    7592960, // -53
    7021380, // -52
    6513750, // -51
    6059060, // -50
    5648680, // -49
    5275800, // -48
    4935020, // -47
    4621990, // -46
    4333220, // -45
    4065840, // -44
    3817520, // -43
    3586310, // -42
    3370600, // -41
    3169000, // -40
    2980330, // -39
    2803600, // -38
    2637910, // -37
    2482470, // -36
    2336580, // -35
    2199620, // -34
    2071020, // -33
    1950230, // -32
    1836790, // -31
    1730230, // -30
    1630150, // -29
    1536140, // -28
    1447840, // -27
    1364900, // -26
    1287000, // -25
    1213820, // -24
    1145090, // -23
    1080530, // -22
    1019890, // -21
    962912, // -20
    909379, // -19
    859074, // -18
    811797, // -17
    767359, // -16
    725581, // -15
    686296, // -14
    649348, // -13
    614590, // -12
    581883, // -11
    551100, // -10
    522117, // -9
    494824, // -8
    469113, // -7
    444886, // -6
    422050, // -5
    400518, // -4
    380209, // -3
    361048, // -2
    342963, // -1
    326560, // 0
    309764, // 1
    294529, // 2
    280131, // 3
    266520, // 4
    253647, // 5
    241470, // 6
    229946, // 7
    219036, // 8
    208706, // 9
    198920, // 10
    189647, // 11
    180857, // 12
    172523, // 13
    164618, // 14
    157118, // 15
    150000, // 16
    143243, // 17
    136827, // 18
    130731, // 19
    124940, // 20
    119435, // 21
    114202, // 22
    109225, // 23
    104491, // 24
    100000, // 25
    95699,  // 26
    91617,  // 27
    87731,  // 28
    84028,  // 29
    80501,  // 30
    77140,  // 31
    73936,  // 32
    70881,  // 33
    67968,  // 34
    65188,  // 35
    62537,  // 36
    60006,  // 37
    57590,  // 38
    55283,  // 39
    53080,  // 40
    50976,  // 41
    48965,  // 42
    47044,  // 43
    45207,  // 44
    43451,  // 45
    41771,  // 46
    40165,  // 47
    38628,  // 48
    37157,  // 49
    35750,  // 50
    34402,  // 51
    33112,  // 52
    31876,  // 53
    30692,  // 54
    29558,  // 55
    28471,  // 56
    27429,  // 57
    26430,  // 58
    25472,  // 59
    24554,  // 60
    23672,  // 61
    22827,  // 62
    22016,  // 63
    21237,  // 64
    20489,  // 65
    19771,  // 66
    19082,  // 67
    18420,  // 68
    17784,  // 69
    17172,  // 70
    16585,  // 71
    16020,  // 72
    15477,  // 73
    14955,  // 74
    14453,  // 75
    13970,  // 76
    13505,  // 77
    13058,  // 78
    12628,  // 79
    12213,  // 80
    11815,  // 81
    11431,  // 82
    11061,  // 83
    10705,  // 84
    10362,  // 85
    10031,  // 86
    9712,   // 87
    9405,   // 88
    9110,   // 89
    8824,   // 90
    8549,   // 91
    8284,   // 92
    8028,   // 93
    7782,   // 94
    7544,   // 95
    7314,   // 96
    7093,   // 97
    6879,   // 98
    6673,   // 99
    6474,   // 100
    6281,   // 101
    6096,   // 102
    5916,   // 103
    5743,   // 104
    5576,   // 105
    5415,   // 106
    5259,   // 107
    5108,   // 108
    4963,   // 109
    4822,   // 110
    4687,   // 111
    4555,   // 112
    4428,   // 113
    4306,   // 114
    4187,   // 115
    4073,   // 116
    3962,   // 117
    3855,   // 118
    3751,   // 119
    3651,   // 120
    3555,   // 121
    3461,   // 122
    3371,   // 123
    3283,   // 124
    3199   // 125
};

int MF52AT_3950_100k_GetTemp(int r) {
    if (r < mf52at_3950_100k_r[0]) {
        return MF52AT_3950_TMIN;
    }
    
    for (int i = 0; i < MF52AT_3950_TCOUNT - 1; i++) {
        if (r >= mf52at_3950_100k_r[i] && r <= mf52at_3950_100k_r[i + 1]) {
            return MF52AT_3950_TMIN + i * MF52AT_3950_TSTEP;
        }
    }

    return MF52AT_3950_TMAX;
}

int MF52AT_3950_GetTemp(int r, int r25_kohm) {
    return MF52AT_3950_100k_GetTemp(r * r25_kohm / 100);
}

const char *MF52AT_UnitTest(void) {
    int temp;

    temp = MF52AT_3950_100k_GetTemp(100000);
    mu_assert("100k 100000", temp == 25);

    temp = MF52AT_3950_100k_GetTemp(9000000);
    mu_assert("100k 9000000", temp == -55);

    temp = MF52AT_3950_100k_GetTemp(1000000);
    mu_assert("100k 1000000", temp == -21);

    temp = MF52AT_3950_100k_GetTemp(3000);
    mu_assert("100k 3000", temp == 125);

    temp = MF52AT_3950_GetTemp(100000, 100);
    mu_assert("100k 100000 (r25_kohm)", temp == 25);

    temp = MF52AT_3950_GetTemp(10000, 10);
    mu_assert("10k 10000 (r25_kohm)", temp == 25);

    temp = MF52AT_3950_GetTemp(3500, 10);
    mu_assert("10k 3500 (r25_kohm)", temp == 50);
    
    temp = MF52AT_3950_GetTemp(300, 10);
    mu_assert("10k 300 (r25_kohm)", temp == 125);

    return 0;
}